# **Phase 3: The "Free Beta" & Anti-Abuse Architecture**

## **1. The "Coming Soon" Monetization Strategy**

Instead of processing payments, the goal is to gauge interest and collect emails for the future launch.

* **Pricing Page:** Still exists, but all "Upgrade" buttons are replaced with **"Join Waitlist"** or **"Notify Me"** buttons.
* **The "Pro" Teaser:** Display features like "Remove Watermark," "4K Export," or "Custom Fonts" as locked/pro features with a "Coming Soon" badge. This builds desire before you even ask for money.

---

## **2. The "Daily Allowance" Credit System**

Since we aren't selling credits, we shouldn't use a "depleting bank account" model (where credits go to zero and stop). Instead, use a **Daily Refill Model**.

* **The Rule:** Every user gets **3-5 Generation Credits per day**.
* **The Reset:** Credits reset every 24 hours (or at midnight UTC).
* **Why this is better:**
* **Retention:** Users have a reason to come back tomorrow.
* **Cost Safety:** You know exactly the maximum cost per user per day.
* **Psychology:** Users feel less "hoarding" anxiety and use the tool more freely to test it.



---

## **3. Advanced Abuse Prevention (The "Freeloader" Defense)**

Since the product is free, people *will* try to exploit it (e.g., bot farms, competitors scraping your backend).

### **Layer 1: Identity Hardening (Google Auth)**

* **Policy:** Strictly enforce **Google OAuth only**. No email/password signups.
* **Validation:** In your Supabase Auth callback, check the `email_verified` field from Google. If `false`, block the login.
* **Domain Filtering (Optional):** If you see abuse from specific temporary email domains (even via Google), add them to a blocklist in the `system_config` table.

### **Layer 2: Upstash Rate Limiting (The IP Shield)**

You need two types of rate limits configured in Upstash:

1. **The "Speed Limit":** 1 request per 10 seconds per user. Prevents double-clicking or script flooding.
2. **The "IP Wall":** Limit account creation/logins to 5 per IP address per hour. This stops someone from writing a script to generate 100 fake Google accounts from a single machine.

### **Layer 3: Device Fingerprinting (Browser-Side)**

* **Tool:** Use a library like **FingerprintJS** (open source version) on the client side.
* **Logic:** When a user clicks "Generate," send their `visitorId` (device hash) to the backend.
* **The Check:**
* Store `visitorId` in a Supabase table linked to the User ID.
* **Rule:** If a single `visitorId` is associated with more than 3 different User IDs (Google accounts), flag the account as "Suspicious" and block generation. This stops one person from logging into 10 different Gmails on the same laptop to bypass limits.



---

## **4. Backend Logic & Database Updates**

### **A. Modified `users` Table**

We need to track *when* the user last generated to handle the daily reset.

* `daily_usage_count` (Integer, Default: 0): How many times they used it today.
* `last_reset_date` (Date, Default: Today): When the counter was last zeroed out.
* `is_banned` (Boolean, Default: false): Manual kill switch for abusive users.

### **B. The "Soft Reset" Logic (No Cron Job Needed)**

Don't run a heavy server job to reset everyone's credits at midnight. Do it **Lazily** (On-Demand).

**Algorithm (Runs when user attempts to generate):**

1. **Fetch User:** Get `daily_usage_count` and `last_reset_date`.
2. **Compare Dates:**
* Is `last_reset_date` < `Current Date`?
* **YES:** Update user -> Set `daily_usage_count = 0`, Set `last_reset_date = Today`. Proceed to Step 3.
* **NO:** Keep current count. Proceed to Step 3.


3. **Check Limit:**
* Is `daily_usage_count` < `DAILY_LIMIT` (from system config)?
* **YES:** Allow generation. Increment `daily_usage_count`.
* **NO:** Reject request. Show error: "Daily limit reached. Come back tomorrow!"



---

## **5. Security & Cost Capping (The "Emergency Brake")**

### **A. The Global Kill Switch**

In your Supabase `system_config` table, add a boolean: `maintenance_mode`.

* If you wake up and see a $500 OpenAI bill, set this to `TRUE` immediately.
* The middleware should check this boolean and reject *all* API requests globally with a "We are upgrading our systems" message.

### **B. Metadata Watermarking**

* **Visible:** Add a subtle "Generated by [YourApp]" watermark in the corner of every image.
* **Invisible:** Add metadata to the PNG file header. If bots scrape your images and repost them, you can prove origin.
* **Why:** Free users are your marketing team. The watermark ensures that if their post goes viral, *you* get traffic.

---

## **6. User Interface Requirements**

### **A. The Credit Badge**

* Place a pill badge in the top navigation bar.
* **Text:** "Free Preview: 3/5 left today".
* **Visual:** A progress bar that fills up as they use credits.

### **B. The "Limit Reached" Modal**

When a user hits the limit, don't just show an error. Show a **"Upsell Teaser"**:

* *Headline:* "You've been busy!"
* *Body:* "You hit your daily limit of 5 designs. The quota resets in [Hours] hours."
* *CTA:* "Join the Pro Waitlist for unlimited access." (Captures their intent to pay).

### **C. The "Report Issue" Button**

Since this is a beta, things *will* break.

* Add a prominent "Report Bug / Feedback" button.
* If a generation fails due to a server error, **do not deduct a credit**. (Wrap the increment logic in a `try/catch` block).